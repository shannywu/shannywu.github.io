<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>[AWS] Create a Glue Catalog Table using AWS CDK | shanny's notes</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-68820773-2','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[AWS] Create a Glue Catalog Table using AWS CDK</h1><a id="logo" href="/blog/.">shanny's notes</a><p class="description"></p></div><div id="nav-menu"><a href="/blog/." class="current"><i class="fa fa-home"> Home</i></a><a href="/blog/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/blog/about/"><i class="fa fa-user"> About</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[AWS] Create a Glue Catalog Table using AWS CDK</h1><div class="post-meta">Jul 4, 2020<span> | </span><span class="category"><a href="/blog/categories/Data-Engineering/">Data Engineering</a></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-AWS-CDK"><span class="toc-number">1.</span> <span class="toc-text">What is AWS CDK?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Start-a-CDK-Project"><span class="toc-number">2.</span> <span class="toc-text">Start a CDK Project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-a-Glue-Catalog-Table-using-CDK"><span class="toc-number">3.</span> <span class="toc-text">Create a Glue Catalog Table using CDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-CDK-App"><span class="toc-number">4.</span> <span class="toc-text">Deploy the CDK App</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Play-with-the-Table-on-AWS-Athena"><span class="toc-number">5.</span> <span class="toc-text">Play with the Table on AWS Athena</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">6.</span> <span class="toc-text">References</span></a></li></ol></div></div><div class="post-content"><p>AWS CDK is a framework to manage cloud resources based on AWS CloudFormation. In this post, I will focus on how to create a Glue Catalog Table using AWS CDK.</p>
<a id="more"></a>
<h2 id="What-is-AWS-CDK"><a href="#What-is-AWS-CDK" class="headerlink" title="What is AWS CDK?"></a>What is AWS CDK?</h2><p>The AWS Cloud Development Kit (AWS CDK) is an open source software development framework to model and provision your cloud application resources based on AWS CloudFormation. You can define the infrastructure of cloud applications using familiar programming languages, including Java, JavaScript, TypeScript, Python, and C#.</p>
<p>For more information, you can read the <a href="https://docs.aws.amazon.com/cdk/latest/guide/home.html" target="_blank" rel="external">Developer Guide</a>. Also, you can find a set of example projects on <a href="https://github.com/aws-samples/aws-cdk-examples" target="_blank" rel="external">Github</a>. </p>
<h2 id="Start-a-CDK-Project"><a href="#Start-a-CDK-Project" class="headerlink" title="Start a CDK Project"></a>Start a CDK Project</h2><p>Follow the <a href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html" target="_blank" rel="external">Getting Started Guide</a> from AWS.</p>
<p>In this post, we are going to work with CDK in Python. Python AWS CDK applications require Python 3.6 or later. </p>
<p>After installing CDK you will be able to create a new AWS CDK project by invoking <code>cdk init</code> in an empty directory. Note that <code>cdk init</code> cannot be run in a non-empty directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> cdk-glue-table</div><div class="line">$ cdk init app --language python</div></pre></td></tr></table></figure>
<p>And you will see the following message:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Applying project template app <span class="keyword">for</span> python</div><div class="line">Initializing <span class="keyword">a</span> <span class="built_in">new</span> git repository...</div><div class="line">Executing Creating virtualenv...</div><div class="line"></div><div class="line"><span class="comment"># Welcome to your CDK Python project!</span></div><div class="line"></div><div class="line">This is <span class="keyword">a</span> blank project <span class="keyword">for</span> Python development <span class="keyword">with</span> CDK.</div></pre></td></tr></table></figure>
<p>It will also show you some useful commands:<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">## Useful commands</div><div class="line"></div><div class="line"> * `cdk ls`          list all stacks <span class="keyword">in</span> the app</div><div class="line"> * `cdk synth`       emits the synthesized CloudFormation template</div><div class="line"> * `cdk deploy`      deploy this stack to your default AWS account/region</div><div class="line"> * `cdk diff`        compare deployed stack <span class="keyword">with</span> current state</div><div class="line"> * `cdk docs`        open CDK documentation</div></pre></td></tr></table></figure></p>
<p>The <code>cdk init</code> command has created a virtualenv for you, to manually activate the virtualenv, use:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">source</span> .env/bin/activate</div></pre></td></tr></table></figure></p>
<p>The next step is to install AWS Construct Library modules for the app to use. AWS Construct Library modules are named like <code>aws-cdk.SERVICE-NAME</code>. In our case, which is to create a Glue catalog table, we need the modules for Amazon S3 and AWS Glue.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install aws-cdk.aws-s3 aws-cdk.aws-glue</div></pre></td></tr></table></figure>
<p>After initialing the project, it will be like:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── .env</div><div class="line">│   ├── bin</div><div class="line">...</div><div class="line">│   ├── include</div><div class="line">│   └── pyvenv.cfg</div><div class="line">├── .gitignore</div><div class="line">├── README.md</div><div class="line">├── app.py</div><div class="line">├── cdk.json</div><div class="line">├── cdk_glue_table</div><div class="line">│   ├── __init__.py</div><div class="line">│   └── cdk_glue_table_stack.py</div><div class="line">├── requirements.txt</div><div class="line">├── setup.py</div><div class="line">└── source.bat</div></pre></td></tr></table></figure></p>
<p>There are two files for developers to pay attention to:</p>
<ul>
<li><code>app.py</code>: The entry point of the CDK app</li>
<li><code>cdk_glue_table/cdk_glue_table_stack.py</code>: Stack is the unit of deployment in the AWS CDK, all AWS resources defined within the scope of a stack</li>
</ul>
<h2 id="Create-a-Glue-Catalog-Table-using-CDK"><a href="#Create-a-Glue-Catalog-Table-using-CDK" class="headerlink" title="Create a Glue Catalog Table using CDK"></a>Create a Glue Catalog Table using CDK</h2><p>In this case, we have the data store in an existing S3 bucket. So this task will be divied into the following steps:</p>
<ol>
<li><p>Import an existing S3 bucket for data storage</p>
<p> If there is a resource which you want to use it in your CDK app, you can import it through the <a href="https://docs.aws.amazon.com/glue/latest/dg/glue-specifying-resource-arns.html" target="_blank" rel="external">resource’s ARN</a> or other identifying attributes by calling a static factory method on the resource’s class. Go to this <a href="https://docs.aws.amazon.com/cdk/latest/guide/resources.html" target="_blank" rel="external">document</a> for more examples. </p>
<p> The following example shows how to import an exisiting S3 bucket.</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> aws_cdk <span class="keyword">import</span> aws_s3 <span class="keyword">as</span> s3</div><div class="line"></div><div class="line">bucket = s3.Bucket.from_bucket_name(self, <span class="string">'my_bucket_id'</span>, <span class="string">'my_bucket'</span>)</div></pre></td></tr></table></figure>
<p> If you want to create a new bucket via CDK, you can visit <a href="https://docs.aws.amazon.com/cdk/api/latest/python/aws_cdk.aws_s3/Bucket.html" target="_blank" rel="external">the document</a> for more information.</p>
</li>
<li><p>Create a <a href="https://docs.aws.amazon.com/cdk/api/latest/python/aws_cdk.aws_glue/Database.html" target="_blank" rel="external">Glue database</a></p>
</li>
</ol>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> aws_cdk <span class="keyword">import</span> aws_glue <span class="keyword">as</span> glue</div><div class="line"></div><div class="line">database = glue.Database(</div><div class="line">    self,</div><div class="line">    id=<span class="string">'my_database_id'</span>,</div><div class="line">    database_name=<span class="string">'poc'</span></div><div class="line">)</div></pre></td></tr></table></figure>

Of course you can import an existing database by calling the method [`from_database_arn`](https://docs.aws.amazon.com/cdk/api/latest/python/aws_cdk.aws_glue/Database.html#aws_cdk.aws_glue.Database.from_database_arn). This [page](https://docs.aws.amazon.com/glue/latest/dg/glue-specifying-resource-arns.html) tells you how to specify Glue resource ARNs.
</code></pre><ol start="3">
<li><p>Create a new <a href="https://docs.aws.amazon.com/cdk/api/latest/python/aws_cdk.aws_glue/Table.html" target="_blank" rel="external">Glue table</a></p>
<p> The following example illustrates how to create a Glue table with the S3 bucket and database we just imported/created.</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">table = glue.Table(</div><div class="line">        self,</div><div class="line">        id=<span class="string">'my_table_id'</span>,</div><div class="line">        database=database,</div><div class="line">        table_name=<span class="string">'my_table'</span>,</div><div class="line">        columns=[</div><div class="line">            glue.Column(</div><div class="line">                name=<span class="string">'col1'</span>,</div><div class="line">                type=glue.Type(</div><div class="line">                    input_string=<span class="string">'string'</span>,</div><div class="line">                    is_primitive=<span class="keyword">True</span></div><div class="line">                )</div><div class="line">            ),</div><div class="line">            glue.Column(</div><div class="line">                name=<span class="string">'col2'</span>,</div><div class="line">                type=glue.Type(</div><div class="line">                    input_string=<span class="string">'int'</span>,</div><div class="line">                    is_primitive=<span class="keyword">True</span></div><div class="line">                )</div><div class="line">            )</div><div class="line">        ],</div><div class="line">        partition_keys=[</div><div class="line">            glue.Column(</div><div class="line">                name=<span class="string">'dt'</span>,</div><div class="line">                type=glue.Type(</div><div class="line">                    input_string=<span class="string">'string'</span>,</div><div class="line">                    is_primitive=<span class="keyword">True</span></div><div class="line">                )</div><div class="line">            )</div><div class="line">        ],</div><div class="line">        bucket=bucket,</div><div class="line">        s3_prefix=<span class="string">'test_data'</span>,</div><div class="line">        data_format=glue.DataFormat(</div><div class="line">            input_format=glue.InputFormat(<span class="string">'org.apache.hadoop.mapred.TextInputFormat'</span>),</div><div class="line">            output_format=glue.OutputFormat(<span class="string">'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'</span>),</div><div class="line">            serialization_library=glue.SerializationLibrary(<span class="string">'org.openx.data.jsonserde.JsonSerDe'</span>)</div><div class="line">        )</div><div class="line">    )</div></pre></td></tr></table></figure>
<p> Don’t forget to give the completed implemented class name for <code>glue.InputFormat</code>, <code>glue.OutputFormat</code> and <code>glue.SerializationLibrary</code>, otherwise it will fail when you try to create the table, with this error message: <code>HIVE_UNKNOWN_ERROR: Unable to create input format TextInputFormat</code>.</p>
</li>
</ol>
<h2 id="Deploy-the-CDK-App"><a href="#Deploy-the-CDK-App" class="headerlink" title="Deploy the CDK App"></a>Deploy the CDK App</h2><p>Before deployment, you can run this command first:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cdk synth</div></pre></td></tr></table></figure></p>
<p>This command emits the synthesized CloudFormation template. </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="attr">Resources:</span></div><div class="line"><span class="attr">  mytableidTableD0000000:</span></div><div class="line"><span class="attr">    Type:</span> <span class="attr">AWS::Glue::Table</span></div><div class="line"><span class="attr">    Properties:</span></div><div class="line"><span class="attr">      CatalogId:</span></div><div class="line"><span class="attr">        Ref:</span> <span class="attr">AWS::AccountId</span></div><div class="line"><span class="attr">      DatabaseName:</span> <span class="string">poc</span></div><div class="line"><span class="attr">      TableInput:</span></div><div class="line"><span class="attr">        Description:</span> <span class="string">my_table</span> <span class="string">generated</span> <span class="string">by</span> <span class="string">CDK</span></div><div class="line"><span class="attr">        Name:</span> <span class="string">my_table</span></div><div class="line"><span class="attr">        Parameters:</span></div><div class="line"><span class="attr">          has_encrypted_data:</span> <span class="literal">false</span></div><div class="line"><span class="attr">        PartitionKeys:</span></div><div class="line"><span class="attr">          - Name:</span> <span class="string">dt</span></div><div class="line"><span class="attr">            Type:</span> <span class="string">string</span></div><div class="line"><span class="attr">        StorageDescriptor:</span></div><div class="line"><span class="attr">          Columns:</span></div><div class="line"><span class="attr">            - Name:</span> <span class="string">col1</span></div><div class="line"><span class="attr">              Type:</span> <span class="string">string</span></div><div class="line"><span class="attr">            - Name:</span> <span class="string">col2</span></div><div class="line"><span class="attr">              Type:</span> <span class="string">int</span></div><div class="line"><span class="attr">          Compressed:</span> <span class="literal">false</span></div><div class="line"><span class="attr">          InputFormat:</span> <span class="string">org.apache.hadoop.mapred.TextInputFormat</span></div><div class="line"><span class="attr">          Location:</span> <span class="attr">s3://my_bucket_name/test_data</span></div><div class="line"><span class="attr">          OutputFormat:</span> <span class="string">org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat</span></div><div class="line"><span class="attr">          SerdeInfo:</span></div><div class="line"><span class="attr">            SerializationLibrary:</span> <span class="string">org.openx.data.jsonserde.JsonSerDe</span></div><div class="line"><span class="attr">          StoredAsSubDirectories:</span> <span class="literal">false</span></div><div class="line"><span class="attr">        TableType:</span> <span class="string">EXTERNAL_TABLE</span></div><div class="line"><span class="attr">    Metadata:</span></div><div class="line"><span class="attr">      aws:</span><span class="attr">cdk:path:</span> <span class="string">cdk-glue-table/my_table_id/Table</span></div></pre></td></tr></table></figure>
<p>Then, deploy the app by running:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> cdk deploy</span></div></pre></td></tr></table></figure>
<p>In this step, you need to be authorized to perform<code>&quot;cloudformation:CreateChangeSet&quot;</code> and <code>&quot;cloudformation:ExecuteChangeSet&quot;</code> on the stack.</p>
<p>If there’s no error message, you can now check if the table is created on AWS Glue. Or you can check it through a <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/glue/get-table.html" target="_blank" rel="external">CLI command</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ aws glue get-table \</div><div class="line">    --database-name poc \</div><div class="line">    --name my_table</div></pre></td></tr></table></figure>
<p>Once the table is well created, it will show you the metadata of the table.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"Table"</span>: &#123;</div><div class="line">        <span class="attr">"Name"</span>: <span class="string">"my_table"</span>,</div><div class="line">        <span class="attr">"DatabaseName"</span>: <span class="string">"poc"</span>,</div><div class="line">        <span class="attr">"Description"</span>: <span class="string">"my_table generated by CDK"</span>,</div><div class="line">        <span class="attr">"CreateTime"</span>: <span class="number">1592295011.0</span>,</div><div class="line">        <span class="attr">"UpdateTime"</span>: <span class="number">1592295011.0</span>,</div><div class="line">        <span class="attr">"Retention"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"StorageDescriptor"</span>: &#123;</div><div class="line">            <span class="attr">"Columns"</span>: [</div><div class="line">                &#123;</div><div class="line">                    <span class="attr">"Name"</span>: <span class="string">"col1"</span>,</div><div class="line">                    <span class="attr">"Type"</span>: <span class="string">"string"</span></div><div class="line">                &#125;,</div><div class="line">                &#123;</div><div class="line">                    <span class="attr">"Name"</span>: <span class="string">"col2"</span>,</div><div class="line">                    <span class="attr">"Type"</span>: <span class="string">"int"</span></div><div class="line">                &#125;</div><div class="line">            ],</div><div class="line">            <span class="attr">"Location"</span>: <span class="string">"s3://my_bucket/test_data"</span>,</div><div class="line">            <span class="attr">"InputFormat"</span>: <span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</div><div class="line">            <span class="attr">"OutputFormat"</span>: <span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</div><div class="line">            <span class="attr">"Compressed"</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">"NumberOfBuckets"</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">"SerdeInfo"</span>: &#123;</div><div class="line">                <span class="attr">"SerializationLibrary"</span>: <span class="string">"org.openx.data.jsonserde.JsonSerDe"</span></div><div class="line">            &#125;,</div><div class="line">            <span class="attr">"SortColumns"</span>: [],</div><div class="line">            <span class="attr">"StoredAsSubDirectories"</span>: <span class="literal">false</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"PartitionKeys"</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">"Name"</span>: <span class="string">"dt"</span>,</div><div class="line">                <span class="attr">"Type"</span>: <span class="string">"string"</span></div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"TableType"</span>: <span class="string">"EXTERNAL_TABLE"</span>,</div><div class="line">        <span class="attr">"Parameters"</span>: &#123;</div><div class="line">            <span class="attr">"has_encrypted_data"</span>: <span class="string">"false"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"CreatedBy"</span>: <span class="string">"arn:aws:iam::aws_account_id:user/user_name"</span>,</div><div class="line">        <span class="attr">"IsRegisteredWithLakeFormation"</span>: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Play-with-the-Table-on-AWS-Athena"><a href="#Play-with-the-Table-on-AWS-Athena" class="headerlink" title="Play with the Table on AWS Athena"></a>Play with the Table on AWS Athena</h2><p>Now that the table is created, we can execute some queries on Athena.</p>
<p>However, a problem occured when I was trying to generate the DDL for table creation: <code>FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask.java.lang.NullPointerException</code>.</p>
<p><img src="https://i.imgur.com/yArCbX0.png" alt=""></p>
<p>In this case, I created the table using CDK, and it was created successfully on AWS Glue. The table looked the same as other tables, I could add partitions to it, and the data could be reached. But when I wanted to get the table description through <code>SHOW CREATE TABLE my_table</code> through Athena, it failed with an Execution Error.</p>
<p>I asked the AWS support for guidance, and they told me that there was a parameter missing. I have to add the parameter <code>&quot;serialization.format&quot;</code> to the Serde Info of the table definition. However, there is no parameters for CDK to add <code>&quot;serialization.format&quot;</code> to the table.</p>
<p>This error happens because the table input did not have some parameters needed by Athena. So the table will work with glue when create a new definition in the data catalog using $ aws glue create-table, however it will not work well with Athena.<br>The property <code>&quot;serialization.format&quot;</code> is set in the table definition for all table created using Athena console irrespective of the input format and the values are the same for different input formats. That is, you don’t have to change the value of this property.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://docs.aws.amazon.com/cdk/latest/guide/resources.html" target="_blank" rel="external">Use existing resources</a></li>
<li><a href="https://kevinslin.com/aws/cdk_all_the_things/" target="_blank" rel="external">CDK All The Things: A Whirlwind Tour</a></li>
<li><a href="https://medium.com/@azole/aws-cdk-%E5%88%9D%E6%8E%A2-5b481d3970bd" target="_blank" rel="external">AWS CDK 初探</a></li>
</ul>
</div><div class="tags"><a href="/blog/tags/Data-Engineering/">Data Engineering</a><a href="/blog/tags/AWS/">AWS</a><a href="/blog/tags/CDK/">CDK</a><a href="/blog/tags/AWS-Glue/">AWS Glue</a></div><div class="post-nav"><a href="/blog/2020/04/19/airflow-kubernetes-pod-operator-cloud-composer/" class="next">[Airflow] Using the KubernetesPodOperator on Cloud Composer</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://shannywu.github.io/blog"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/04/aws-create-a-glue-catalog-table-using-cdk/">[AWS] Create a Glue Catalog Table using AWS CDK</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/04/19/airflow-kubernetes-pod-operator-cloud-composer/">[Airflow] Using the KubernetesPodOperator on Cloud Composer</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/04/03/airflow-scheduling/">[Airflow] Scheduling</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/23/data-explore-hotel-review/">[Data] Explore the Hotel Review Data</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/16/spark-job-on-amazon-emr/">[Spark] Run Spark Job on Amazon EMR</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/01/10/tensorflow-variable/">[Tensorflow] 初學筆記 (3) Variable</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/01/06/tensorflow-session/">[Tensorflow] 初學筆記 (2) Session</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/01/05/tensorflow-introduction/">[Tensorflow] 初學筆記 (1) Tensorflow 簡介</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2016/11/22/python-nltk-tools/">[Python] NLTK 工具整理</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2016/07/26/windows-flask-mod-wsgi-apache-on-windows/">Flask + mod_wsgi + Apache on Windows</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Data/">Data</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Data-Engineering/">Data Engineering</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Lecture-Notes/">Lecture Notes</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Machine-Learning/">Machine Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Miscellaneous/">Miscellaneous</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Python/">Python</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/blog/tags/Airflow/" style="font-size: 15px;">Airflow</a> <a href="/blog/tags/Data-Engineering/" style="font-size: 15px;">Data Engineering</a> <a href="/blog/tags/AWS/" style="font-size: 15px;">AWS</a> <a href="/blog/tags/CDK/" style="font-size: 15px;">CDK</a> <a href="/blog/tags/AWS-Glue/" style="font-size: 15px;">AWS Glue</a> <a href="/blog/tags/Cloud-Composer/" style="font-size: 15px;">Cloud Composer</a> <a href="/blog/tags/GCP/" style="font-size: 15px;">GCP</a> <a href="/blog/tags/Data/" style="font-size: 15px;">Data</a> <a href="/blog/tags/Python/" style="font-size: 15px;">Python</a> <a href="/blog/tags/nltk/" style="font-size: 15px;">nltk</a> <a href="/blog/tags/re/" style="font-size: 15px;">re</a> <a href="/blog/tags/linux/" style="font-size: 15px;">linux</a> <a href="/blog/tags/sort/" style="font-size: 15px;">sort</a> <a href="/blog/tags/grep/" style="font-size: 15px;">grep</a> <a href="/blog/tags/zgrep/" style="font-size: 15px;">zgrep</a> <a href="/blog/tags/edit-distance/" style="font-size: 15px;">edit distance</a> <a href="/blog/tags/spelling-correction/" style="font-size: 15px;">spelling correction</a> <a href="/blog/tags/collocation/" style="font-size: 15px;">collocation</a> <a href="/blog/tags/Linggle/" style="font-size: 15px;">Linggle</a> <a href="/blog/tags/map-reduce/" style="font-size: 15px;">map reduce</a> <a href="/blog/tags/pattern-grammar/" style="font-size: 15px;">pattern grammar</a> <a href="/blog/tags/WriteAhead/" style="font-size: 15px;">WriteAhead</a> <a href="/blog/tags/filter/" style="font-size: 15px;">filter</a> <a href="/blog/tags/standford-parser/" style="font-size: 15px;">standford parser</a> <a href="/blog/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/blog/tags/map/" style="font-size: 15px;">map</a> <a href="/blog/tags/match/" style="font-size: 15px;">match</a> <a href="/blog/tags/search/" style="font-size: 15px;">search</a> <a href="/blog/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/blog/tags/wordnet/" style="font-size: 15px;">wordnet</a> <a href="/blog/tags/reduce/" style="font-size: 15px;">reduce</a> <a href="/blog/tags/Tensorflow/" style="font-size: 15px;">Tensorflow</a> <a href="/blog/tags/tmux/" style="font-size: 15px;">tmux</a> <a href="/blog/tags/apache/" style="font-size: 15px;">apache</a> <a href="/blog/tags/flask/" style="font-size: 15px;">flask</a> <a href="/blog/tags/mod-wsgi/" style="font-size: 15px;">mod_wsgi</a> <a href="/blog/tags/windows/" style="font-size: 15px;">windows</a> <a href="/blog/tags/Spark/" style="font-size: 15px;">Spark</a> <a href="/blog/tags/EMR/" style="font-size: 15px;">EMR</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/blog/." rel="nofollow">shanny's notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=0.0.0"></script></div></body></html>